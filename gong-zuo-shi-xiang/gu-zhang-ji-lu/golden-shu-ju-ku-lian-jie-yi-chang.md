# golden 数据库链接异常

## 故障背景

paas 2.0 使用 mysql 驱动与 golden db 进行链接， paas 2.0 由于未正式推广，实际业务流量并不高

## 故障现象

应用月版投产时，出现 mysql has gonne away 报错，无法访问数据库，但是重试后恢复正常

## 故障分析

该故障并未在研发环境出现，但开发/SIT环境偶尔出现相同报错日志

根据报错信息推测，可能是与数据库链接出现中断。

排查数据库配置，链接超时为8小时空闲回收。

排查 gorm 框架，发现框架内的连接池已经实现了连接池心跳机制

心跳机制由 mysql 驱动提供，使用了 mysql ping 方法，经核对，golden 无法识别该方法，虽然保持了与应用的连接，但不会将请求转发到mysql，导致生产环境在没有业务访问下 mysql 在8小时后关闭连接

## 故障处理

由于 golden 并不计划提供 golang 版本的数据库驱动，也不计划修复该问题引起的连接失效。

所以目前调整连接池设置，将连接存活方式改为非活跃连接每小时关闭再重建解决。
