# CPC内存争用

### 功能背景

通过内存队列进行异步任务管理，根据队列内容发起 k8s job 的创建、监听动作，并对已经在监听的任务进行忽略

每秒从数据库读取数据并进行队列更新

### 故障现象

长时间运行中，有概率出现大量的 goroutine 进程打印，同时容器进行重启

### 故障排查

根据 panic 信息，推测是由于map 争用导致。根据提示信息，定位到异步任务管理逻辑。

经过单元测试进行多线程并发压测，发现由于高并发情况下，存在同时多协程对 map 内容进行更新和删除的动作，导致出现 map 异常

### 故障修复

使用 sync.Map / sync.Mutex 对 map 操作加锁控制完成修复
